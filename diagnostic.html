<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Fabric UI Diagnostic</title>
    <style>
        body {
            font-family: system-ui;
            padding: 20px;
            background: #f5f5f5;
        }
        .status { padding: 10px; margin: 10px 0; background: white; border-radius: 8px; }
        .pass { border-left: 4px solid green; }
        .fail { border-left: 4px solid red; }
        .info { border-left: 4px solid blue; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Ultra Fabric UI Deployment Diagnostic</h1>

    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        async function runDiagnostics() {
            // Test 1: Check live site content
            const test1 = document.createElement('div');
            test1.className = 'status info';
            test1.innerHTML = '<h3>Test 1: Fetching Live Site</h3>';
            results.appendChild(test1);

            try {
                const response = await fetch('https://britishmade.ai/');
                const text = await response.text();

                // Check for key elements
                const checks = [
                    { name: 'Ultra Fabric Orb CSS', pattern: /ultra-fabric-orb/, expected: true },
                    { name: 'Fabric color variables', pattern: /--fabric-terracotta/, expected: true },
                    { name: 'Animation keyframes', pattern: /@keyframes ultraWeave/, expected: true },
                    { name: 'Orb HTML structure', pattern: /ultra-fabric-sphere/, expected: true },
                    { name: 'Old agent-avatar class', pattern: /agent-avatar.*gradient/, expected: false }
                ];

                checks.forEach(check => {
                    const found = check.pattern.test(text);
                    const status = (found === check.expected) ? 'pass' : 'fail';
                    const result = document.createElement('div');
                    result.className = `status ${status}`;
                    result.innerHTML = `<strong>${check.name}:</strong> ${found ? 'Found' : 'Not found'} ${status === 'pass' ? '✅' : '❌'}`;
                    results.appendChild(result);
                });

                // Count occurrences
                const orbCount = (text.match(/ultra-fabric-orb/g) || []).length;
                const sphereCount = (text.match(/ultra-fabric-sphere/g) || []).length;

                const counts = document.createElement('div');
                counts.className = 'status info';
                counts.innerHTML = `
                    <h3>Element Counts</h3>
                    <p>ultra-fabric-orb references: <strong>${orbCount}</strong></p>
                    <p>ultra-fabric-sphere references: <strong>${sphereCount}</strong></p>
                `;
                results.appendChild(counts);

                // Extract and show a sample of the orb HTML
                const orbMatch = text.match(/<div class="ultra-fabric-orb[^>]*>[\s\S]*?<\/div>\s*<\/div>/);
                if (orbMatch) {
                    const sample = document.createElement('div');
                    sample.className = 'status info';
                    sample.innerHTML = `
                        <h3>Sample Orb HTML Found in Message Template</h3>
                        <pre>${orbMatch[0].replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                    `;
                    results.appendChild(sample);
                }

            } catch (error) {
                test1.innerHTML += `<p style="color: red;">Error fetching site: ${error.message}</p>`;
            }

            // Test 2: Check for potential issues
            const issues = document.createElement('div');
            issues.className = 'status info';
            issues.innerHTML = `
                <h3>Common Issues to Check</h3>
                <ol>
                    <li><strong>Browser Cache:</strong> Try hard refresh (Ctrl+Shift+R or Cmd+Shift+R)</li>
                    <li><strong>Console Errors:</strong> Open DevTools (F12) and check Console tab</li>
                    <li><strong>Network Tab:</strong> Verify index.html is loading fresh (not 304 cached)</li>
                    <li><strong>Initial State:</strong> The orb only appears in agent messages, not in the UI initially</li>
                    <li><strong>Test Message:</strong> Send "test" to see if agent response shows orb</li>
                </ol>
            `;
            results.appendChild(issues);

            // Test 3: Show what to expect
            const expect = document.createElement('div');
            expect.className = 'status info';
            expect.innerHTML = `
                <h3>What You Should See</h3>
                <p>When you send a message and get an agent response:</p>
                <ul>
                    <li>Instead of a gradient avatar circle on the left</li>
                    <li>You should see an animated orb with:</li>
                    <li>- Fabric-inspired colors (terracotta, sage, bark)</li>
                    <li>- Pulsing animation (4 second cycle)</li>
                    <li>- Color shifting effect (8 second cycle)</li>
                </ul>
            `;
            results.appendChild(expect);
        }

        runDiagnostics();
    </script>
</body>
</html>